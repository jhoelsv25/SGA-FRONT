<div class="relative user-menu-container w-full">
  <!-- Trigger -->
  <button
    (click)="toggleMenu()"
    class="w-full flex items-center gap-3 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200"
  >
    <div class="relative shrink-0">
      @if (avatar(); as img) {
        <img
          [src]="img"
          alt="Avatar"
          class="w-10 h-10 rounded-full object-cover border-2 border-gray-200 dark:border-gray-600"
        />
      } @else {
        <div
          class="w-10 h-10 flex items-center justify-center rounded-full bg-primary-600 text-white font-bold border-2 border-gray-200 dark:border-gray-600"
        >
          {{ initials() }}
        </div>
      }
    </div>
    <div class="flex-1 text-left min-w-0">
      <div class="text-sm font-semibold text-gray-800 dark:text-white truncate">
        {{ name() }}
      </div>
      <div class="text-xs text-gray-500 dark:text-gray-400 truncate">{{ role() }}</div>
    </div>
    <i
      class="fas fa-chevron-up text-xs text-gray-500 transition-transform duration-200 shrink-0"
      [class.rotate-180]="open()"
    ></i>
  </button>

  <!-- Dropdown (Opens Upward) -->

  <div
    [ngClass]="open() ? 'menu-anim-enter' : 'menu-anim-leave'"
    class="absolute left-0 right-0 bottom-full mb-2 w-full bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 z-50 overflow-hidden origin-bottom"
  >
    <!-- Header -->
    <div class="bg-primary-500 p-4 text-white">
      <h3 class="font-semibold truncate">{{ name() }}</h3>
      <p class="text-white/80 text-sm">{{ role() }}</p>
      <p class="text-white/60 text-xs">C칩digo: {{ code() }}</p>
    </div>

    <!-- Stats -->
    <div class="grid grid-cols-3 gap-4 p-4 bg-gray-50 dark:bg-gray-700/50">
      <div class="text-center">
        <div class="text-lg font-bold">{{ stats().courses }}</div>
        <div class="text-xs text-gray-500">Cursos</div>
      </div>
      <div class="text-center">
        <div class="text-lg font-bold">{{ stats().students }}</div>
        <div class="text-xs text-gray-500">Estudiantes</div>
      </div>
      <div class="text-center">
        <div class="text-lg font-bold">{{ stats().average }}</div>
        <div class="text-xs text-gray-500">Promedio</div>
      </div>
    </div>

    <!-- Acciones din치micas -->
    <div class="py-2">
      @for (item of actions(); track $index) {
        <button
          (click)="
            item.type === 'theme'
              ? handleThemeAction(item, $event)
              : handleAction(item)
          "
          class="w-full flex items-center gap-3 px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200"
        >
          @if (item.type === "theme") {
            <div class="w-5 flex justify-center">
              @switch (item.icon) {
                @case ("theme-light") {
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="w-4 h-4 text-primary"
                  >
                    <circle cx="12" cy="12" r="4"></circle>
                    <path d="M12 2v2"></path>
                    <path d="M12 20v2"></path>
                    <path d="M4.93 4.93l1.41 1.41"></path>
                    <path d="M17.66 17.66l1.41 1.41"></path>
                    <path d="M2 12h2"></path>
                    <path d="M20 12h2"></path>
                    <path d="M6.34 17.66l-1.41 1.41"></path>
                    <path d="M19.07 4.93l-1.41 1.41"></path>
                  </svg>
                }
                @case ("theme-dark") {
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="w-4 h-4 text-primary"
                  >
                    <path
                      d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
                    ></path>
                  </svg>
                }
                @case ("theme-system") {
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    class="w-4 h-4 text-primary"
                  >
                    <rect
                      x="2"
                      y="3"
                      width="20"
                      height="14"
                      rx="2"
                      ry="2"
                    ></rect>
                    <line x1="8" y1="21" x2="16" y2="21"></line>
                    <line x1="12" y1="17" x2="12" y2="21"></line>
                  </svg>
                }
              }
            </div>
          } @else {
            <i [class]="item.icon + ' w-5 text-primary'"></i>
          }
          <span class="flex-1 text-left">{{ item.label }}</span>
        </button>
      }
    </div>

    <!-- Logout fijo -->
    <div class="p-4 border-t border-gray-200 dark:border-gray-600">
      <button
        (click)="handleAction({ label: 'Cerrar Sesi칩n', type: 'logout' })"
        class="bg-primary-600 w-full flex items-center justify-center gap-2 text-white py-2.5 px-4 rounded-lg font-semibold transition-all duration-200 transform hover:scale-[1.02]"
      >
        <i class="fas fa-sign-out-alt"></i>
        <span>Cerrar Sesi칩n</span>
      </button>
    </div>
  </div>
</div>
