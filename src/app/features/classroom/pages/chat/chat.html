<div class="h-[650px] bg-white rounded-3xl shadow-xl shadow-slate-200/50 border border-slate-100 flex flex-col overflow-hidden animate-in zoom-in-95 duration-500">
  <!-- Chat Header -->
  <div class="p-4 border-b border-slate-100 flex items-center justify-between bg-slate-50/50">
    <div>
      <h3 class="font-bold text-slate-800">Chat de la clase</h3>
      <p class="text-xs text-slate-500 flex items-center gap-2 mt-0.5">
        <sga-badge color="success" variant="subtle" size="sm">
          <span class="w-1.5 h-1.5 rounded-full bg-current animate-pulse mr-1"></span>
          En línea
        </sga-badge>
      </p>
    </div>
  </div>

  <!-- Messages List -->
  <div class="flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 bg-slate-50/30">
    @for (msg of store.chatMessages(); track msg.id) {
      <div class="flex flex-col" [ngClass]="isMe(msg) ? 'items-end' : 'items-start'">
        <div class="flex items-end gap-2 max-w-[85%]">
          @if (!isMe(msg)) {
            <div class="w-8 h-8 rounded-xl bg-primary/10 shrink-0 flex items-center justify-center text-sm font-bold text-primary">
              {{ msg.senderName[0] || '?' }}
            </div>
          }
          <div
            class="px-4 py-2.5 rounded-2xl text-sm font-medium shadow-sm"
            [ngClass]="isMe(msg) ? 'bg-primary text-white rounded-tr-none' : 'bg-white text-slate-700 border border-slate-100 rounded-tl-none'"
          >
            @if (!isMe(msg)) {
              <p class="text-xs font-semibold opacity-80 mb-1">{{ msg.senderName }}</p>
            }
            <p class="wrap-break-word">{{ msg.content }}</p>
          </div>
        </div>
        <span class="text-xs text-slate-400 mt-1" [ngClass]="isMe(msg) ? 'mr-12' : 'ml-12'">{{ msg.timestamp }}</span>
      </div>
    } @empty {
      <div class="flex flex-col items-center justify-center h-full text-center text-slate-400 py-12">
        <i class="fas fa-comments text-4xl mb-3 opacity-50"></i>
        <p class="text-sm font-medium">Aún no hay mensajes</p>
        <p class="text-xs mt-1">Escribe abajo para iniciar la conversación.</p>
      </div>
    }
  </div>

  <!-- Chat Input -->
  <div class="p-4 bg-white border-t border-slate-100">
    <div class="flex items-center gap-2 bg-slate-50 rounded-2xl px-3 py-2 focus-within:ring-2 focus-within:ring-primary/20 transition-all">
      <sga-input
        type="text"
        [ngModel]="newMessage()"
        (ngModelChange)="newMessage.set($event)"
        (keyup.enter)="sendMessage()"
        placeholder="Escribe un mensaje..."
      />
      <button
        type="button"
        sgaButton
        variant="solid"
        color="primary"
        size="sm"
        shape="square"
        [disabled]="!newMessage().trim() || sending()"
        (click)="sendMessage()"
        [attr.aria-label]="'Enviar mensaje'"
      >
        @if (sending()) {
          <i class="fas fa-spinner fa-spin"></i>
        } @else {
          <i class="fas fa-paper-plane"></i>
        }
      </button>
    </div>
  </div>
</div>
