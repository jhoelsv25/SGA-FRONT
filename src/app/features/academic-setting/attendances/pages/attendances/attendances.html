<div class="p-8 max-w-5xl mx-auto font-sans">
  <header class="flex justify-between items-center mb-8 bg-white p-6 rounded-xl shadow-md border border-slate-100">
    <h1 class="text-2xl font-bold text-slate-800 m-0">Registro de Asistencia</h1>
    <div class="flex gap-6">
      <div class="flex flex-col gap-2 min-w-40">
        <label for="attendance-date-input" class="text-sm font-semibold text-slate-500">Fecha</label>
        <sga-input
          id="attendance-date-input"
          type="date"
          [ngModel]="attendanceDate()"
          (ngModelChange)="attendanceDate.set($event); onDateChange()"
        />
      </div>
      <div class="flex flex-col gap-2 min-w-56">
        <label for="attendance-section-select" class="text-sm font-semibold text-slate-500">Curso / SecciÃ³n</label>
        <sga-select
          id="attendance-section-select"
          [options]="sectionCourseOptions()"
          [value]="selectedSectionCourse()"
          (valueChange)="onSectionCourseChange($event)"
          placeholder="Seleccione..."
          [searchable]="false"
        />
      </div>
    </div>
  </header>

  <div class="bg-white rounded-xl shadow-md border border-slate-100 overflow-hidden mb-8">
    <table class="w-full border-collapse">
      <thead>
        <tr class="bg-slate-50 border-b border-slate-200">
          <th class="p-4 text-left text-sm font-semibold text-slate-600">Estudiante</th>
          <th class="p-4 text-left text-sm font-semibold text-slate-600">Estado</th>
          <th class="p-4 text-left text-sm font-semibold text-slate-600">Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (student of students(); track student.id) {
          <tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
            <td class="p-4 text-slate-800 font-medium">{{ student.name }}</td>
            <td class="p-4">
              <span 
                class="px-3 py-1 rounded-full text-xs font-bold capitalize inline-block"
                [ngClass]="{
                  'bg-green-100 text-green-700': student.status === 'present',
                  'bg-yellow-100 text-yellow-700': student.status === 'late',
                  'bg-red-100 text-red-700': student.status === 'absent',
                  'bg-blue-100 text-blue-700': student.status === 'excused'
                }"
              >
                {{ student.status }}
              </span>
            </td>
            <td class="p-4">
              <div class="flex gap-2">
                <button 
                  class="w-8 h-8 rounded-lg border border-slate-200 font-bold text-xs transition-all flex items-center justify-center" 
                  [ngClass]="student.status === 'present' ? 'bg-green-500 text-white border-green-500' : 'bg-white text-slate-600 hover:bg-green-50 hover:border-green-500 hover:text-green-600'"
                  (click)="updateStatus(student.id, 'present')">P</button>
                <button 
                  class="w-8 h-8 rounded-lg border border-slate-200 font-bold text-xs transition-all flex items-center justify-center" 
                  [ngClass]="student.status === 'late' ? 'bg-yellow-500 text-white border-yellow-500' : 'bg-white text-slate-600 hover:bg-yellow-50 hover:border-yellow-500 hover:text-yellow-600'"
                  (click)="updateStatus(student.id, 'late')">T</button>
                <button 
                  class="w-8 h-8 rounded-lg border border-slate-200 font-bold text-xs transition-all flex items-center justify-center" 
                  [ngClass]="student.status === 'absent' ? 'bg-red-500 text-white border-red-500' : 'bg-white text-slate-600 hover:bg-red-50 hover:border-red-500 hover:text-red-600'"
                  (click)="updateStatus(student.id, 'absent')">F</button>
                <button 
                  class="w-8 h-8 rounded-lg border border-slate-200 font-bold text-xs transition-all flex items-center justify-center" 
                  [ngClass]="student.status === 'excused' ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-slate-600 hover:bg-blue-50 hover:border-blue-500 hover:text-blue-600'"
                  (click)="updateStatus(student.id, 'excused')">J</button>
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <footer class="flex justify-end">
    <button 
      class="px-6 py-3 bg-blue-600 text-white rounded-lg font-bold shadow-lg hover:bg-blue-700 transition-all disabled:bg-slate-300 disabled:cursor-not-allowed disabled:shadow-none flex items-center gap-2"
      (click)="saveAttendances()" 
      [disabled]="!selectedSectionCourse() || store.loading()"
    >
      @if (store.loading()) {
        <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Guardando...
      } @else {
        Guardar Asistencias
      }
    </button>
  </footer>
</div>
