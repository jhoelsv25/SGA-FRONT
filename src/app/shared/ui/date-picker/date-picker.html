<!-- Date Picker Component -->
<div class="relative w-full">
  <!-- Trigger Input -->
  <div
    class="flex items-center justify-between w-full min-h-10 px-3 py-2 text-sm border rounded-lg cursor-pointer transition-all duration-200 outline-none"
    [class]="getTriggerClasses()"
    (click)="toggleCalendar()"
    tabindex="0"
    role="button"
    [attr.aria-expanded]="isOpen()"
    [attr.aria-disabled]="isDisabled()"
  >
    <!-- Display Text -->
    <div class="flex items-center gap-2 flex-1">
      <i class="fas fa-calendar text-primary-500"></i>
      <span
        class="truncate"
        [class]="
          hasSelection()
            ? 'text-neutral-800 dark:text-white font-medium'
            : 'text-neutral-400 dark:text-neutral-300'
        "
      >
        {{ displayText() }}
      </span>
    </div>

    <!-- Clear Button -->
    @if (clearable() && hasSelection() && !isDisabled()) {
      <button
        type="button"
        class="flex items-center justify-center w-5 h-5 text-neutral-400 hover:text-neutral-600 hover:bg-base-200 rounded transition-colors duration-200 dark:text-neutral-300 dark:hover:text-white"
        (click)="clearSelection(); $event.stopPropagation()"
        tabindex="-1"
      >
        <i class="fas fa-times text-xs"></i>
      </button>
    }

    <!-- Dropdown Arrow -->
    <div
      class="flex items-center justify-center w-5 h-5 text-neutral-400 transition-transform duration-200 dark:text-neutral-300"
      [class.rotate-180]="isOpen()"
    >
      <i class="fas fa-chevron-down text-xs"></i>
    </div>
  </div>

  <!-- Calendar Dropdown -->
  @if (isOpen()) {
    <div
      class="absolute top-full left-0 right-0 z-50 mt-1 bg-base border border-base-300 rounded-lg shadow-xl overflow-hidden animate-in slide-in-from-top-2 duration-200 dark:bg-base dark:border-base-200"
      style="min-width: 280px; max-width: 320px"
    >
      <!-- Calendar Header -->
      <div class="flex items-center justify-between px-4 py-3 bg-primary-500 text-white">
        <button
          type="button"
          class="flex items-center justify-center w-8 h-8 rounded-md hover:bg-primary-600 transition-colors duration-200"
          (click)="previousMonth()"
        >
          <i class="fas fa-chevron-left"></i>
        </button>

        <button
          type="button"
          class="text-sm font-semibold capitalize hover:bg-primary-600 px-3 py-1 rounded-md transition-colors duration-200"
          (click)="goToToday()"
        >
          {{ currentMonthYear() }}
        </button>

        <button
          type="button"
          class="flex items-center justify-center w-8 h-8 rounded-md hover:bg-primary-600 transition-colors duration-200"
          (click)="nextMonth()"
        >
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>

      <!-- Calendar Body -->
      <div class="p-4">
        <!-- Week Days Header -->
        <div class="grid grid-cols-7 gap-1 mb-2">
          @for (day of weekDays; track $index) {
            <div class="text-xs font-semibold text-neutral-500 dark:text-neutral-400 text-center">
              {{ day }}
            </div>
          }
        </div>

        <!-- Calendar Days -->
        <div class="grid grid-cols-7 gap-1">
          @for (date of calendarDays(); track date.getTime()) {
            <div
              [class]="getDayClasses(date)"
              (click)="selectDate(date)"
              (keydown.enter)="selectDate(date)"
              (keydown.space)="selectDate(date)"
              (mouseenter)="onDateHover(date)"
              tabindex="0"
              role="button"
              [attr.aria-label]="'Seleccionar ' + date.toLocaleDateString()"
            >
              {{ date.getDate() }}
            </div>
          }
        </div>
      </div>

      <!-- Range Mode Info -->
      @if (rangeMode() && hasSelection()) {
        <div
          class="px-4 py-3 border-t border-base-200 bg-base-50 dark:bg-base-100 text-xs text-neutral-600 dark:text-neutral-300"
        >
          @if (selectedRange().start && !selectedRange().end) {
            <span>Selecciona la fecha final...</span>
          } @else if (selectedRange().start && selectedRange().end) {
            <span>Rango seleccionado</span>
          }
        </div>
      }
    </div>
  }
</div>
